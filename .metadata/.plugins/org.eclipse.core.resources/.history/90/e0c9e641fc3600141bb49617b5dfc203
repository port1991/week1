/* Database Controller */
Ti.API.debug('\nDatabase Controller Initialized\n=================');

// Create a new database or open an existing one
Ti.API.debug('-Creating/Opening countries Database table');

Ti.API.debug('--Open Database FIRST--');
var db = Titanium.Database.open('countries');//  OPEN DATABASE

Ti.API.debug('-Creating countries Table');
db.execute('CREATE TABLE IF NOT EXISTS countries (id INTEGER PRIMARY KEY, name TEXT, description TEXT)');
db.close();  // close database
Ti.API.debug('--Close Database FIRST--');

// Create a database table and define columns

// Retrieve ALL data from the databasee
exports.orm = function() {//was changed from normal functions to methods thats why we use orm here.
	Ti.API.debug('-Defining findAll function');
	this.findAll = function() {
		// Open DB

		var data = [];

		Ti.API.debug('--Open Database FIND ALL--');
		db = Titanium.Database.open('countries');   //open database
		var row_databse = db.execute('SELECT * FROM countries');

		console.log("Reading from countries");

		while (row_databse.isValidRow()) {
			Ti.API.debug(row_databse.fieldByName('name'));
			Ti.API.debug(row_databse.fieldByName('id'));

			data.push({
				title : row_databse.fieldByName('name'),    //name os the item in database
				id : row_databse.fieldByName('id')          // id of item in database
			});

			row_databse.next();
		}
		db.close();  //close database
		Ti.API.debug('--Close Database FIND ALL--');

		console.log('countries contains ' + data.length + ' country.');
		console.log('countries contains ' + data);

		return data;
	};

	// Retrieve a specific row from the database
	this.findOne = function(id) {
		Ti.API.debug('Finding Item ' + id);

		Ti.API.debug('--Open Database FIND ONE--');
		db = Titanium.Database.open('countries');   //open database

		var currentRow = db.execute('SELECT * FROM countries WHERE ID=?', id);

		var rowData = {};
		rowData.id = currentRow.fieldByName('id');
		rowData.name = currentRow.fieldByName('name');
		//rowData.description = currentRow.fieldByName('description');

		Ti.API.debug('Item ' + id + ' is ' + JSON.stringify(rowData));

		db.close();   //close database
		Ti.API.debug('--Close Database FIND ONE--');

		return rowData;
	};
	

    
};
Ti.API.debug(' \n \n --= End Database Controller =-- \n \n ');
